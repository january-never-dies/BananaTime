<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
  <title>24/7 With DDEOSUNGEE</title>
  <meta name="description" content="24/7 With... BANANA." />
  <style>
    *,*::before,*::after{box-sizing:border-box}

    /* ============================================================================
      NeoDunggeunmo (Neo둥근모)
      Copyright © 2017-2024, Eunbin Jeong (Dalgona.) <project-neodgm@dalgona.dev>
      with reserved font name "Neo둥근모" and "NeoDunggeunmo".
      이 게임은 해당 글꼴의 라이선스 전문을 포함합니다.
      전문은 neodgm-LICENSE.txt에서 확인할 수 있습니다.
    ============================================================================ */
    @font-face{
      font-family: 'NeoDunggeunmo';
      src: url('neodgm.ttf') format('truetype'); /* 같은 폴더에 neodgm.ttf 배치 */
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }

    :root{
      --bg:#fff9e9; --ink:#1f1f1f; --brand:#ffbd2e; --ui:#242424;
      --font: 'NeoDunggeunmo', 'Apple SD Gothic Neo', 'Noto Sans KR', system-ui, sans-serif;

      --logo-height: 50px;
      --logo-pad-y: 3px;
      --logo-pad-x: 12px;
      --logo-gap: 1px;

      --wrap-pad: 12px;
      --wrap-pad-top-extra: 4px;
    }

    html,body{
      height:100%;
      margin:0;
      background:var(--bg); color:var(--ink);
      font-family: var(--font);
      letter-spacing: 0;
      overflow:hidden; overscroll-behavior:none; touch-action:none;
    }

    .wrap{
      height:100dvh; width:100vw;
      display:grid; grid-template-rows:1fr auto auto; gap:10px;
      padding: calc(max(var(--wrap-pad), env(safe-area-inset-top)) + var(--wrap-pad-top-extra))
               max(var(--wrap-pad), env(safe-area-inset-right))
               max(var(--wrap-pad), env(safe-area-inset-bottom))
               max(var(--wrap-pad), env(safe-area-inset-left));
    }

    .logo-fixed{
      position:fixed;
      top: calc(max(var(--wrap-pad), env(safe-area-inset-top)));
      left: calc(max(var(--wrap-pad), env(safe-area-inset-left)));
      z-index: 30;
      display:inline-grid; place-items:center;
      height: var(--logo-height);
      padding: var(--logo-pad-y) var(--logo-pad-x);
      border:2px dashed rgba(0,0,0,.25);
      border-radius:10px;
      background:rgba(255,255,255,.28);
      backdrop-filter:saturate(100%) blur(2px);
      color:#6b6b6b; font-weight:800; font-size:12px;
      user-select:none;
      min-width: 170px;
      font-family: var(--font);
    }
    .logo-fixed img.logo{height:var(--logo-height); width:auto; display:block}

    /* ▼ 로고 PNG가 실제로 들어갔을 때의 스타일 */
    .logo-fixed.has-img{
      border:0;
      background:transparent;
      padding:0;
      min-width:auto;
    }
    .logo-fixed.has-img img.logo{
      display:block;
      height:var(--logo-height);
      width:auto;
    }

    #stage{
      position:relative;
      min-height:0;
      border-radius:14px;
      overflow:hidden;
      margin-top: calc(var(--logo-height) + (var(--logo-pad-y) * 2) + var(--logo-gap));
    }
    canvas{
      image-rendering:pixelated; display:block; width:100%; height:100%;
      background:linear-gradient(0deg,#fff7d1,#fff1b0);
    }

    .hud{
      position:absolute; inset:8px 10px auto 10px;
      display:grid; grid-template-columns:1fr auto 1fr; align-items:center; gap:8px;
      font-weight:900; font-size:14px; text-shadow:0 2px 6px rgba(0,0,0,.25);
      color:#1a1a1a; z-index:10; pointer-events:none;
      font-family: var(--font);
    }
    .hud .left{justify-self:start}
    .hud .center{justify-self:center}
    .hud .right{justify-self:end}

    .group{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
    button.btn, a.btn{
      appearance:none;border:none;background:var(--brand);color:#1b1b1b;font-weight:800;
      padding:10px 14px;border-radius:12px;cursor:pointer;
      box-shadow:0 6px 16px rgba(0,0,0,.15);text-decoration:none;display:inline-block;
      font-family: var(--font); letter-spacing:.5px
    }
    button.btn:active{transform:translateY(1px)}
    .hidden{display:none!important}

    .footer{font-size:11px;opacity:.85;text-align:center;font-family: var(--font)}
    .footer .sep{opacity:.4;margin:0 6px}
    .footer a{ text-decoration:none; }
    .footer a.copyright{ text-decoration:underline; }

    .start-overlay{
      position:absolute; inset:0; display:grid; place-items:center; text-align:center;
      background:rgba(0,0,0,.35); color:#fff; padding:20px; z-index:20;
      font-family: var(--font);
    }
    .start-box{
      background:rgba(0,0,0,.35); border-radius:12px; padding:16px 18px; max-width:min(90%,520px)
    }
    .start-title{font:900 22px var(--font); margin-bottom:8px}
    .start-sub{font:800 18px var(--font); margin-bottom:8px}
    .start-help{font:600 14px var(--font); opacity:.95; line-height:1.5}
  </style>
</head>
<body>
  <!-- 처음엔 슬롯(텍스트 상자)로 시작, PNG가 로드되면 JS가 이미지로 교체 -->
  <div class="logo-fixed" id="logoSlot">LOGO PNG</div>

  <div class="wrap">
    <div id="stage" aria-label="WITH Monkey Game Stage">
      <canvas id="game" width="360" height="640"></canvas>

      <div class="hud" id="hud">
        <div class="left">점수: <span id="score">0</span></div>
        <div class="center">남은시간: <span id="time">30</span>s</div>
        <div class="right">❤️ <span id="lives">3</span> · 최고: <span id="best">0</span></div>
      </div>

      <div class="start-overlay" id="startOverlay" role="dialog" aria-modal="true">
        <div class="start-box">
          <div class="start-title">Banana Time!</div>
          <div class="start-sub">드래그하여 이동</div>
          <div class="start-help">골든 바나나(+5) · 썩은 바나나(❤️-1) · 시간 바나나(⏱ +2s)</div>
        </div>
      </div>
    </div>

    <div class="group">
      <button class="btn" id="startBtn">떠숭이 밥주기</button>
      <button class="btn hidden" id="shareBtn">공유하기</button>
      <a class="btn hidden" id="buyBtn" href="#" target="_blank" rel="noopener" aria-label="떠숭이 인형 구매하기">떠숭이 인형 구매하기</a>
    </div>

    <div class="footer">
      X(@ddeosungee)
      <span class="sep">·</span>
      <a class="copyright" href="neodgm-LICENSE.txt" target="_blank" rel="noopener">
        Copyright © 2017-2024, Eunbin Jeong (Dalgona.) &lt;project-neodgm@dalgona.dev&gt;
        with reserved font name "NeoDunggeunmo" and "NeoDunggeunmo".
      </a>
    </div>
  </div>

  <script>
  // ========= CONFIG =========
  const CONFIG = {
    GAME_SECONDS: 30,
    MONKEY_SPEED: 6,
    BASE_SPAWN: 34,
    FALL_MIN: 2,
    FALL_MAX: 5,
    GOLDEN_CHANCE: 0.08,
    ROTTEN_CHANCE: 0.03,
    SHAKE_FRAMES: 18,
    MONKEY_FLASH: 14,
    DRIFT_VX_MAX: 1.6,
    DRIFT_AX: 0.02,
    DRIFT_SIN_MIN: 0.1,
    DRIFT_SIN_MAX: 0.8,
    DRIFT_FREQ_MIN: 0.04,
    DRIFT_FREQ_MAX: 0.10,
    PAIR_CHANCE: 0.28,
    PAIR_SPACING: 42,
    PAIR_VX_PUSH: 0.35,
    TIMEBANANA_PERIOD_S: 4,
    TIMEBANANA_JITTER_S: 2,
    TIMEBANANA_ADD_S: 2,
    SHOP_URL: "https://example.com/plush",
    TITLE_TEXT: "Banana Time"
  };

  // ========= UTIL =========
  const ASSET_BASE = new URL('./', location.href);
  const asset = (name) => new URL(name, ASSET_BASE).toString();

  function loadImage(src){
    return new Promise((resolve) => {
      const img = new Image();
      img.crossOrigin = 'anonymous';
      img.onload = () => resolve(img);
      img.onerror = (e) => { console.error('[ImageLoadFail]', src, e?.message || e); resolve(null); };
      img.src = src;
    });
  }

  const clamp=(x,a,b)=>Math.max(a,Math.min(b,x));
  const lerp=(a,b,t)=>a+(b-a)*t;
  const rand=(min,max)=>Math.random()*(max-min)+min;

  function hit(a,b){
    return Math.abs(a.x - b.x) < (a.w/2 + b.w/2) &&
           Math.abs(a.y - b.y) < (a.h/2 + b.h/2);
  }

  // ========= DOM =========
  const canvas=document.getElementById('game');
  const stage=document.getElementById('stage');
  const ctx=canvas.getContext('2d'); ctx.imageSmoothingEnabled=false;
  const ui={
    score:document.getElementById('score'), time:document.getElementById('time'), best:document.getElementById('best'),
    lives:document.getElementById('lives'), startBtn:document.getElementById('startBtn'),
    shareBtn:document.getElementById('shareBtn'), buyBtn:document.getElementById('buyBtn'),
    startOverlay:document.getElementById('startOverlay')
  };

  const FONT_NAME = 'NeoDunggeunmo, Apple SD Gothic Neo, Noto Sans KR, system-ui, sans-serif';
  const f = (w, px) => `${w} ${px}px ${FONT_NAME}`;
  const fnt = (weight, size) => f(weight, size);

  // ========= RESPONSIVE CANVAS =========
  function fitCanvas(){
    const W = stage.clientWidth;
    const H = stage.clientHeight;
    canvas.width = W;
    canvas.height = H;
    canvas.style.width = '100%';
    canvas.style.height = '100%';
  }
  addEventListener('resize', fitCanvas);
  addEventListener('orientationchange', fitCanvas);
  if (window.visualViewport) { visualViewport.addEventListener('resize', fitCanvas); }

  // ========= STATE =========
  const state={
    running:false, frame:0, score:0, timeLeft:CONFIG.GAME_SECONDS,
    lives:3, shake:0, monkeyFlash:0,
    // ▼ 원숭이 픽셀 크기 56×56
    monkey:{x:180,y:570,w:56,h:56},
    bananas:[],
    assets:{monkey:null,gold:null,rotten:null,time:null,logo:null,bg:null},
    lastTick:0, spawnEvery:CONFIG.BASE_SPAWN, rafId:null, timeAcc:0,
    timeBananaFrames: 0,
    bubble:{text:'',frames:0},
    floaters:[]
  };

  // ========= SHARE HANDLER =========
  function share(){
    const url = location.href;
    const title = `${CONFIG.TITLE_TEXT} — SCORE ${state.score}`;
    const text  = `내 점수 ${state.score}점! 떠숭이 밥주기 해봐 🍌`;

    if (navigator.share) {
      navigator.share({ title, text, url }).catch(()=>{});
    } else {
      try {
        navigator.clipboard?.writeText(url);
        alert('링크가 복사되었습니다:\n' + url);
      } catch {
        prompt('아래 링크를 복사해 주세요:', url);
      }
    }
  }

  // ========= INPUT =========
  const keys=new Set(); addEventListener('keydown',e=>keys.add(e.key)); addEventListener('keyup',e=>keys.delete(e.key));
  let touchStartX = null;
  function pointerStart(clientX){const rect=canvas.getBoundingClientRect();touchStartX=(clientX-rect.left)*(canvas.width/rect.width);}
  function pointerMove(clientX){if(touchStartX===null)return;const rect=canvas.getBoundingClientRect();const x=(clientX-rect.left)*(canvas.width/rect.width);const deltaX=x-touchStartX;state.monkey.x = clamp(state.monkey.x+deltaX*1.3, state.monkey.w/2, canvas.width - state.monkey.w/2);touchStartX=x;}
  canvas.addEventListener('mousedown',e=>{pointerStart(e.clientX);canvas.addEventListener('mousemove',mouseMoveHandler);});
  canvas.addEventListener('touchstart',e=>{if(e.touches[0])pointerStart(e.touches[0].clientX);},{passive:true});
  function mouseMoveHandler(e){pointerMove(e.clientX);}
  canvas.addEventListener('touchmove',e=>{if(e.touches[0])pointerMove(e.touches[0].clientX);},{passive:true});
  addEventListener('mouseup',()=>{touchStartX=null;canvas.removeEventListener('mousemove',mouseMoveHandler);});
  addEventListener('touchend',()=>{touchStartX=null;},{passive:true});

  ui.startBtn.addEventListener('click',startGame);
  ui.shareBtn.addEventListener('click',share);

  // ========= GAME LOOP =========
  function startGame(){
    if(state.rafId){ cancelAnimationFrame(state.rafId); state.rafId = null; }
    state.running=true; state.frame=0; state.score=0; state.timeLeft=CONFIG.GAME_SECONDS; state.lives=3; state.shake=0; state.monkeyFlash=0; state.bananas=[]; state.spawnEvery=CONFIG.BASE_SPAWN;
    state.timeAcc = 0;

    ui.score.textContent='0'; ui.time.textContent=CONFIG.GAME_SECONDS; ui.lives.textContent='3';
    ui.startBtn.textContent='다시 시작'; ui.shareBtn.classList.add('hidden'); ui.buyBtn.classList.add('hidden');

    ui.startOverlay.classList.add('hidden');

    state.monkey.x = canvas.width/2;
    state.monkey.y = canvas.height - 70;

    resetTimeBananaTimer();
    canvas.onclick = null;
    state.lastTick = performance.now();
    state.rafId = requestAnimationFrame(loop);
  }

  function loop(now){
    if(!state.running) return;
    const dt = (now - state.lastTick) / 1000 || 0;
    if(!isFinite(dt) || dt < 0){ state.lastTick = now; state.rafId = requestAnimationFrame(loop); return; }
    state.lastTick = now;

    state.timeAcc += dt;
    while(state.timeAcc >= 1 && state.running){
      state.timeLeft = Math.max(0, state.timeLeft - 1);
      state.timeAcc -= 1;
    }
    document.getElementById('time').textContent = state.timeLeft;
    if(state.timeLeft <= 0 || state.lives <= 0){ endGame(); return; }

    try { update(); draw(); state.frame++; }
    catch(err){ console.error('[GameLoop]', err); endGame(); return; }

    state.rafId = requestAnimationFrame(loop);
  }

  // ========= SPAWN =========
  function spawnOne(kind){
    const speed=lerp(CONFIG.FALL_MIN,CONFIG.FALL_MAX+state.score*0.02,Math.random());
    const vx=(Math.random()-0.5)*1.0;
    const sinAmp=lerp(CONFIG.DRIFT_SIN_MIN,CONFIG.DRIFT_SIN_MAX,Math.random());
    const sinFreq=lerp(CONFIG.DRIFT_FREQ_MIN,CONFIG.DRIFT_FREQ_MAX,Math.random());
    state.bananas.push({kind,x:rand(24,canvas.width-24),y:-30,vx,vy:speed,w:46,h:46,phase:Math.random()*Math.PI*2,sinAmp,sinFreq,ax:0});
  }
  function spawnPair(){
    const centerX = rand(40, canvas.width-40);
    const leftX = clamp(centerX - CONFIG.PAIR_SPACING/2, 16, canvas.width-16);
    const rightX = clamp(centerX + CONFIG.PAIR_SPACING/2, 16, canvas.width-16);
    const speedBase = lerp(CONFIG.FALL_MIN, CONFIG.FALL_MAX+state.score*0.02, Math.random());
    const amp1=lerp(CONFIG.DRIFT_SIN_MIN,CONFIG.DRIFT_SIN_MAX,Math.random());
    const amp2=lerp(CONFIG.DRIFT_SIN_MIN,CONFIG.DRIFT_SIN_MAX,Math.random());
    const f1=lerp(CONFIG.DRIFT_FREQ_MIN,CONFIG.DRIFT_FREQ_MAX,Math.random());
    const f2=lerp(CONFIG.DRIFT_FREQ_MIN,CONFIG.DRIFT_FREQ_MAX,Math.random());
    const goldOnLeft = Math.random()<0.5;
    const k1 = goldOnLeft ? 'gold' : 'rotten';
    const k2 = goldOnLeft ? 'rotten' : 'gold';
    state.bananas.push({kind:k1, x:leftX, y:-30, vx:-CONFIG.PAIR_VX_PUSH, vy:speedBase, w:46,h:46, phase:Math.random()*Math.PI*2, sinAmp:amp1, sinFreq:f1, ax:0});
    state.bananas.push({kind:k2, x:rightX, y:-30, vx:+CONFIG.PAIR_VX_PUSH, vy:speedBase*1.02, w:46,h:46, phase:Math.random()*Math.PI*2, sinAmp:amp2, sinFreq:f2, ax:0});
  }
  function spawnTimeBanana(){
    const speed=lerp(CONFIG.FALL_MIN+0.5,CONFIG.FALL_MAX+state.score*0.02,Math.random());
    const vx=(Math.random()-0.5)*0.8;
    const sinAmp=lerp(CONFIG.DRIFT_SIN_MIN,CONFIG.DRIFT_SIN_MAX,Math.random());
    const sinFreq=lerp(CONFIG.DRIFT_FREQ_MIN,CONFIG.DRIFT_FREQ_MAX,Math.random());
    state.bananas.push({kind:'time',x:rand(24,canvas.width-24),y:-30,vx,vy:speed,w:46,h:46,phase:Math.random()*Math.PI*2,sinAmp,sinFreq,ax:0});
  }
  function resetTimeBananaTimer(){
    const base=CONFIG.TIMEBANANA_PERIOD_S;
    const j=CONFIG.TIMEBANANA_JITTER_S;
    const period=(base + (Math.random()*2-1)*j);
    state.timeBananaFrames=Math.max(2, Math.round(period*60));
  }

  // ========= UPDATE =========
  function update(){
    if(keys.has('ArrowLeft')||keys.has('a')) state.monkey.x-=CONFIG.MONKEY_SPEED;
    if(keys.has('ArrowRight')||keys.has('d')) state.monkey.x+=CONFIG.MONKEY_SPEED;
    state.monkey.x=clamp(state.monkey.x, state.monkey.w/2, canvas.width - state.monkey.w/2);

    if (state.frame % state.spawnEvery === 0) {
      if (Math.random() < CONFIG.PAIR_CHANCE) {
        spawnPair();
      } else {
        const total = CONFIG.GOLDEN_CHANCE + CONFIG.ROTTEN_CHANCE || 1;
        const kind = (Math.random() < (CONFIG.ROTTEN_CHANCE / total)) ? 'rotten' : 'gold';
        spawnOne(kind);
      }
    }

    state.timeBananaFrames--;
    if(state.timeBananaFrames<=0){ spawnTimeBanana(); resetTimeBananaTimer(); }

    for(let i=state.bananas.length-1;i>=0;i--){
      const b=state.bananas[i];
      b.ax += (Math.random()*2-1)*CONFIG.DRIFT_AX; b.ax = clamp(b.ax,-CONFIG.DRIFT_AX,CONFIG.DRIFT_AX);
      b.vx += b.ax; b.vx = clamp(b.vx,-CONFIG.DRIFT_VX_MAX,CONFIG.DRIFT_VX_MAX);
      b.x += b.vx + Math.sin(state.frame*b.sinFreq + b.phase)*b.sinAmp;
      b.y += b.vy;
      const half=b.w/2;
      if(b.x<half){ b.x=half; b.vx=Math.abs(b.vx)*0.6; b.phase += 0.9; }
      if(b.x>canvas.width-half){ b.x=canvas.width-half; b.vx=-Math.abs(b.vx)*0.6; b.phase += 0.9; }

      if(hit(b,state.monkey)){
        state.bananas.splice(i,1);
        if(b.kind==='rotten'){
          state.lives = Math.max(0, state.lives - 1); document.getElementById('lives').textContent = state.lives;
          state.shake = CONFIG.SHAKE_FRAMES; state.monkeyFlash = CONFIG.MONKEY_FLASH;
          addFloater(b.x, b.y, 'Oops.', 30);
        } else if(b.kind==='time'){
          state.timeLeft = Math.min(state.timeLeft + CONFIG.TIMEBANANA_ADD_S, CONFIG.GAME_SECONDS + 10);
          document.getElementById('time').textContent = state.timeLeft;
          addFloater(b.x, b.y, '⏱+'+CONFIG.TIMEBANANA_ADD_S+'s', 30);
        } else {
          const gain=(b.kind==='gold'?5:1); state.score+=gain; document.getElementById('score').textContent=state.score;
          if(b.kind==='gold'){ addFloater(b.x,b.y,'Yum!', 30); }
        }
        if(state.score%6===0) state.spawnEvery=Math.max(14,state.spawnEvery-1);
      } else if(b.y>canvas.height+40){
        state.bananas.splice(i,1);
      }
    }

    if(state.shake>0) state.shake--;
    if(state.monkeyFlash>0) state.monkeyFlash--;
    if(state.bubble.frames>0) state.bubble.frames--;
  }

  // ========= DRAW =========
  function draw(){
    let ox=0, oy=0; if(state.shake>0){ ox=Math.round((Math.random()*2-1)*4); oy=Math.round((Math.random()*2-1)*4); }
    ctx.save(); ctx.translate(ox,oy);
    ctx.clearRect(-ox,-oy,canvas.width,canvas.height);
    drawSky();
    if(state.frame<120) drawTitleRibbon(CONFIG.TITLE_TEXT);
    ctx.fillStyle='rgba(0,0,0,0.08)'; ctx.fillRect(0,canvas.height-20,canvas.width,4);
    for(const b of state.bananas) drawBanana(b);
    drawMonkey(state.monkey.x,state.monkey.y,state.monkey.w,state.monkey.h);

    for(let i=state.floaters.length-1;i>=0;i--){
      const f=state.floaters[i]; ctx.save();
      const alpha=Math.max(0, f.frames/30); ctx.globalAlpha = alpha;
      ctx.fillStyle='#fff'; ctx.font = fnt(700, 16);
      ctx.textAlign='center';
      ctx.strokeStyle='rgba(0,0,0,0.35)'; ctx.lineWidth=4; ctx.strokeText(f.text, f.x, f.y);
      ctx.fillStyle='#fff'; ctx.fillText(f.text, f.x, f.y);
      ctx.restore(); f.y -= 0.7; f.frames--; if(f.frames<=0) state.floaters.splice(i,1);
    }

    ctx.restore();
  }

  // ========= END =========
  function endGame(){
    if(state.rafId){ cancelAnimationFrame(state.rafId); state.rafId = null; }
    state.running=false; draw();
    ctx.fillStyle='rgba(0,0,0,0.45)'; ctx.fillRect(0,0,canvas.width,canvas.height);
    const msg=`SCORE ${state.score}`;
    ctx.fillStyle='#fff'; ctx.font = fnt(700, 24);
    ctx.textAlign='center';
    ctx.fillText('Banana Time Over!',canvas.width/2,canvas.height/2-22);
    ctx.fillText(msg,canvas.width/2,canvas.height/2+10);
    const best=Number(localStorage.getItem('bestScore')||0);
    if(state.score > best) {
      localStorage.setItem('bestScore', state.score);
      document.getElementById('best').textContent = state.score;
    } else {
      document.getElementById('best').textContent = best;
    }
    document.getElementById('shareBtn').classList.remove('hidden');
    document.getElementById('buyBtn').classList.remove('hidden');
    document.getElementById('startOverlay').classList.remove('hidden');
  }

  // ========= DRAW HELPERS =========
  function drawSky(){
    if(state.assets.bg){
      ctx.drawImage(state.assets.bg, 0, 0, canvas.width, canvas.height);
    } else {
      const g=ctx.createLinearGradient(0,0,0,canvas.height);
      g.addColorStop(0,'#fff7d1');
      g.addColorStop(1,'#fff1b0');
      ctx.fillStyle=g;
      ctx.fillRect(0,0,canvas.width,canvas.height);
    }
  }
  function drawTitleRibbon(text){
    ctx.save(); ctx.translate(canvas.width/2, 70);
    ctx.fillStyle = 'rgba(0,0,0,.08)'; roundedRect(-150,-22,300,44,12,true);
    ctx.fillStyle = '#111'; ctx.font = fnt(700, 18); ctx.textAlign='center';
    ctx.fillText(text,0,6); ctx.restore()
  }
  function roundedRect(x,y,w,h,r,fill){ ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); if(fill) ctx.fill(); else ctx.stroke() }
  function drawMonkey(cx,cy,w,h){
    if(state.assets.monkey){
      ctx.drawImage(state.assets.monkey,cx-w/2,cy-h/2,w,h)
    } else {
      ctx.save(); ctx.translate(cx,cy);
      ctx.fillStyle='#6b4f2a'; roundedRect(-w/2,-h/2,w,h,20,true);
      ctx.fillStyle='#f7d9b1'; roundedRect(-w/2+12,-h/2+14,w-24,h-28,16,true);
      ctx.fillStyle='#1b1b1b'; ctx.beginPath(); ctx.arc(-14,-8,6,0,Math.PI*2); ctx.arc(14,-8,6,0,Math.PI*2); ctx.fill();
      ctx.restore()
    }
  }
  function drawBanana(b){
    if(b.kind==='gold'   && state.assets.gold)   { ctx.drawImage(state.assets.gold,   b.x-b.w/2,b.y-b.h/2,b.w,b.h); return; }
    if(b.kind==='rotten' && state.assets.rotten) { ctx.drawImage(state.assets.rotten, b.x-b.w/2,b.y-b.h/2,b.w,b.h); return; }
    if(b.kind==='time'   && state.assets.time)   { ctx.drawImage(state.assets.time,   b.x-b.w/2,b.y-b.h/2,b.w,b.h); return; }
    // fallback
    ctx.save(); ctx.translate(b.x,b.y);
    ctx.fillStyle = (b.kind==='rotten')? '#7a5a3a' : (b.kind==='gold'? '#ffd84d' : '#7ad1ff');
    ctx.beginPath(); ctx.ellipse(0,0,b.w*0.55,b.h*0.35,-0.6,0,Math.PI*2); ctx.fill(); ctx.restore();
  }
  function addFloater(x,y,text,frames){ state.floaters.push({x,y,text,frames:frames||28}); }

  // ===== 스크롤/줌 완전 잠금 =====
  (function lockPageScroll(){
    const prevent = e => { e.preventDefault(); };
    window.addEventListener('touchmove', prevent, {passive:false});
    window.addEventListener('wheel', prevent, {passive:false});
    document.addEventListener('gesturestart', prevent);
    document.addEventListener('dblclick', prevent);
    const blockKeys = new Set(['ArrowUp','ArrowDown','ArrowLeft','ArrowRight','Space','PageUp','PageDown','Home','End']);
    window.addEventListener('keydown', (e) => { if (blockKeys.has(e.key)) e.preventDefault(); }, {passive:false});
  })();

  // ========= BOOT =========
  async function boot(){
    await document.fonts.ready;
    const [monkey,gold,rotten,time,logo,bg]=await Promise.all([
      loadImage(asset('monkey.png')),
      loadImage(asset('banana_gold.png')),
      loadImage(asset('banana_rotten.png')),
      loadImage(asset('banana_time.png')),
      loadImage(asset('logo.png')),
      loadImage(asset('background.png')),
    ]);
    state.assets={monkey,gold,rotten,time,logo,bg};
    fitCanvas();
    draw();
    document.getElementById('best').textContent=localStorage.getItem('bestScore')||0;

    /* ▼ 로고가 로드되면 슬롯을 이미지로 교체 */
    const slot = document.getElementById('logoSlot');
    if (logo) {
      slot.classList.add('has-img');
      // 캐시 문제 있으면 ?v=숫자 붙여도 OK
      slot.innerHTML = `<img class="logo" src="${asset('logo.png')}" alt="24/7 WITH DDEOSUNGEE">`;
    }
  }
  if(document.readyState!=='loading'){ boot(); } else { addEventListener('DOMContentLoaded', boot); }
  </script>
</body>
</html>

